const http = require('http');
const https = require('https');
exports.get = function(url) {
  const events = {};
  const lib = url.startsWith('https') ? https : http;
  const req = lib.get(url, res => {
    let data = '';
    res.on('data', chunk => data += chunk);
    res.on('end', () => {
      if (res.statusCode >= 400) {
        if (events['complete']) events['complete'](new Error('Status ' + res.statusCode));
      } else {
        if (events['complete']) events['complete'](data);
      }
    });
  });
  req.on('error', err => {
    if (events['complete']) events['complete'](err);
  });
  return { on: (name, cb) => { events[name] = cb; } };
};
